<!DOCTYPE html>

<html>

<head>
  <title>Assignment 8</title>

  <link rel="stylesheet" href="style.css">

  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <script src="Ground.js"></script>
  <script src="Cloud.js"></script>
  <script src="Player.js"></script>
  <script src="Gun.js"></script>
  <script src="Shape.js"></script>
  <script src="Button.js"></script>
  <script src="utils.js"></script>

  <script type="text/javascript">

    // Globals variables
    var c, gc;
    var frame = 0;
    var shapeType = [];
    var waitingShapes = [];
    var runningShapes = [];
    var player;
    // var gun;
    var ground;
    // var hit;
    var shootingShots = [];
    var clouds = [];
    var gameStart;

    // Shape colors
    var colors = ['#FFFF8D',
    							'#dff69e',
              		'#00ceff',
    							'#ee78aa',
              		'#3f159f',
              		'#71b583',
              		'#00a2ff'];

    <!-- onload Function -->
    window.onkeydown = function(e) {
      if (e.keyCode == 32 || e.keyCode == 38 && e.target == document.body) {
        e.preventDefault();
        player.setJumped(true);
      }
      else if (e.keyCode == 39 || e.keyCode == 65 && e.target == document.body) {
        e.preventDefault();

        let type = "circle"; // test input
        shootAShot(type);
        // console.log('Shoot a shot');
      }
      else if (e.keyCode == 83 && e.target == document.body) {
        e.preventDefault();

        let type = "rectangle"; // test input
        shootAShot(type);
      }
      else if (e.keyCode == 68 && e.target == document.body) {
        e.preventDefault();

        let type = "triangle"; // test input
        shootAShot(type);
      }
      else if (e.keyCode == 70 && e.target == document.body) {
        e.preventDefault();

        let type = "square"; // test input
        shootAShot(type);
      }
      else if (e.keyCode == 70 && e.target == document.body) {
        e.preventDefault();

        let type = "rhombus"; // test input
        shootAShot(type);
      }
      else if (e.keyCode == 81 && e.target == document.body) {
        e.preventDefault();

        let type = "parallelogram"; // test input
        shootAShot(type);
      }
      else if (e.keyCode == 87 && e.target == document.body) {
        e.preventDefault();

        let type = "parallelogram"; // test input
        shootAShot(type);
      }
      else if (e.keyCode == 69 && e.target == document.body) {
        e.preventDefault();

        let type = "pentagon"; // test input
        shootAShot(type);
      }
      else if (e.keyCode == 82 && e.target == document.body) {
        e.preventDefault();

        let type = "hexagon"; // test input
        shootAShot(type);
      }
    }

    window.onload = function() {
      // Set up canvas
      c = document.getElementById("MyCanvas");
      gc = c.getContext("2d");
      c.width = window.innerWidth;
      c.height = window.innerHeight-100;

      // Key event listener
      // c.addEventListener('keydown', function(event) {
      //     if(event.keyCode == 32) {
      //         player.setJumped(true);
      //     }
      //     console.log("press the space bar");
      // });
      // c.focus();

      gameStart = false;
      // Create Player and Gun
      player = new Player();
      // hit = false;
      // gun = new Gun(player, "Circle");

      // Create Shapes
      // createShape(20);

      // Create clouds
      for (var i=0; i<5; i++) {
        var cloud = new Cloud();
        clouds.push(cloud);
      }
      ground = new Ground();

      // Draw background, Player
      drawAll();

      // Add buttons
      new Button("Start");
      new Button("Stop");

      console.log("onload")
    }

    <!-- Function -->
    function drawBackground() {
      // Draw background color
      var grd=gc.createLinearGradient(0,75,0,750);
      grd.addColorStop(0,"#FFAFBD");
      grd.addColorStop(1,"#ffc3a0");
      gc.fillStyle = "#EEEEEE"; //#43C6AC #FFAFBD #d3d3d3 #FFEB3B grd
      gc.fillRect(0, 0, c.width, c.height);

      // Draw ground images
      // let x = 0;
      // let y = c.height/9;
      // let image = 'images/ground1.png';
      // window.onload = function(){
      //   context.drawImage(image, x, y);
      // }
      // console.log("draw ground image");
    }

    // Make new shape items and put them in waitingShapes array list
    // function createShape(int) {
    //   console.log("call create shape");
    //   // Make an arrayList for containing all types of shapes
    //   var shapeType = [];
    //   shapeType.push("circle", "rectangle"); //"square", "ellipse", "triangle"
    //
    //   // Get a random type of shape
    //   var randomShape = shapeType[Math.floor(Math.random() * shapeType.length)];
    //
    //   for (var i=0; i<int; i++) {
    //     var shp;
    //
    //     if (randomShape == "circle") {
    //       shp = new Circle();
    //     } else if (randomShape == "rectangle") {
    //       shp = new Rectangle();
    //     }
    //     // Put the initialized item in the arrayList
    //     waitingShapes.push(shp);
    //     console.log(i + " create shape")
    //   }
    // }

    function drawAll() {
      gc.clearRect(0, 0, c.width, c.height);
      // Background
      drawBackground();

      // Ground
      ground.draw(gc);

      // Clouds
      for (var i=0; i<clouds.length; i++) {
        var cloud = this.clouds[i];
        cloud.draw(gc);
        // console.log("draw cloud");
      }

      // Player
      player.draw(gc);

      // Gun
      for (var i=0; i<shootingShots.length; i++) {
        var shot = this.shootingShots[i];
        shot.draw(gc);
      }

      // Shape
      for (var i=0; i< runningShapes.length; i++) {
        var shape = this.runningShapes[i];
        shape.draw(gc);
      }
    }

    function tick() {

      if (gameStart) {
        frame ++;

        // Clouds
        for (var i=0; i< clouds.length; i++) {
          var cloud = this.clouds[i];
          cloud.tick();
        }

        // Ground
        ground.tick();

        // Player
        player.tick();

        // Gun
        for (var i=0; i<shootingShots.length; i++) {
          var shot = this.shootingShots[i];
          shot.tick(gc);
        }

        // Shapes
        for (var i=0; i< runningShapes.length; i++) {
          var shape = this.runningShapes[i];
          shape.tick();
        }

        // Check collision between player and shapes
        for (var i=0; i< runningShapes.length; i++) {
          var shape = this.runningShapes[i];
          console.log("collision check");
          if (isCollided(player, shape)) {
            console.log("damaged");
            // player.decreaseSize
          }
          // for (var i=0; i< shootingShots.length; i++) { // shots and shapes
          //   var shot = this.shootingShots[i];
          //   if (collided(shape, shot)) {
          //     shootingShots.remove(shot);
          //     runningShapes.remove(shape);
          //     console.log("good job!");
          //   }
          // }
        }

        setTimeout(tick, 100); // tick every 100 msec
      }



      // Redraw all with updated data
      drawAll();
    }

    function launchShape() {
      // Containing all types of shapes
      shapeType.push("circle", "rectangle"); //"square", "ellipse", "triangle"

      // Get a random type of shape
      var randomShape = shapeType[Math.floor(Math.random() * shapeType.length)];
      var shp;
      console.log("launch " ,shp);

      if (randomShape == "circle") {
        shp = new Circle();
      } else if (randomShape == "rectangle") {
        shp = new Rectangle();
      }

      runningShapes.push(shp); // Put the initialized item in the arrayList
      // console.log("call launch shape");
    }

    // Shoot a gun
    function shootAShot(type) {
      var sht;

      if (type == "circle") {
        sht = new Gun(player, "Circle");
      } else if (type == "rectangle") {
        sht = new Gun(player, "Rectangle");
      } else if (type == "triangle") {
        sht = new Gun(player, "Triangle");
      } else if (type == "square") {
        sht = new Gun(player, "Square");
      } else if (type == "rhombus") {
        sht = new Gun(player, "Rhombus");
      } else if (type == "parallelogram") {
        sht = new Gun(player, "Parallelogram");
      } else if (type == "pentagon") {
        sht = new Gun(player, "Pentagon");
      } else if (type == "hexagon") {
        sht = new Gun(player, "Hexagon");
      }
      console.log(sht);

      shootingShots.push(sht); // Put the initialized item in the arrayList
      sht.setShooting(true); // Set isShot state as true

      // console.log("Shoot a shot");
    }

    // function isInside(bb, point) {
    //   if( bb.ix <= p.x && p.x <= bb.ax && bb.iy <= p.y && p.y <= bb.ay ) {
      // bb is the bounding box, (ix, iy) are its top-left coordinates
      // (ax, ay) are its bottom-right coordinates
    //   }
    // }

    // Check if objects collide with each other
    function isCollided(obj1, obj2) {
      console.log("isCollided ", obj1.x, " ", obj2.x)
      if (obj1.x < obj2.x + obj2.width  && obj1.x + obj1.width  > obj2.x &&
    		  obj1.y < obj2.y + obj2.height && obj1.y + obj1.height > obj2.y) {
      // The objects are touching
        return true;
      }


    //   var obj1Rect = obj1.getBoundingClientRect();
    //   var obj2Rect = obj1.getBoundingClientRect();
     //
    //   if (
    //    ((obj1Rect.top + obj1Rect.height) < (obj2Rect.top)) ||
    //    (obj1Rect.top > (obj2Rect.top + obj2Rect.height)) ||
    //    ((obj1Rect.left + obj1Rect.width) < obj2Rect.left) ||
    //    (obj1Rect.left > (obj2Rect.left + obj2Rect.width))
    //  ) {
    //    return true;
    //  }

      // var topLeft = new Point(obj1.x, obj1.y);
      // var topRight = new Point(obj1.x+obj1.width, obj1.y);
      // var bottomLeft = new Point(obj1.x, obj1.y+obj1.height);
      // var bottomRight = new Point(obj1.x+obj1.width, obj1.y+obj1.height);

      // if (inInside(obj1, topLeft)) {
      //     return true;
      // } else if (obj2.inInside(topRight)) {
      //     return true;
      // } else if (obj2.inInside(bottomLeft)) {
      //     return true;
      // } else if (obj2.inInside(bottomRight)) {
      //     return true;
      // }

      // topLeft = new Point(obj2.x, obj2.y);
      // topRight = new Point(obj2.x+obj2.width, obj2.y);
      // bottomLeft = new Point(obj2.x, obj2.y+obj2.height);
      // bottomRight = new Point(obj2.x+obj2.width, obj2.y+obj2.height);
      //
      // if (obj1.contains(topLeft)) {
      //     return true;
      // } else if (obj1.contains(topRight)) {
      //     return true;
      // } else if (obj1.contains(bottomLeft)) {
      //     return true;
      // } else if (obj1.contains(bottomRight)) {
      //     return true;
      // }
      return false;
    }


    // func  tion select(event) {
    //   var x = event.clientX;
    //   var y = event.clientY;
    //   var rect = c.getBoundingClientRect();
    //   var collide = false;
    //
    //   for (i = 0; i < animals.length; i++) {
    //     var boundX = animals[i].x - (animals[i].size / 2);
    //     var boundY = animals[i].y - (animals[i].size / 2);
    //
    //     if (boundX <= x + rect.left && x + rect.left <= (boundX + animals[i].size) &&
    //       boundY <= y - rect.top && y - rect.top <= (boundY + animals[i].size)) {
    //       selected = animals[i];
    //       collide = true;
    //
    //       document.getElementById("statusmsg").innerHTML =
    //         "Mouse down at " + event.clientX + ", " + event.clientY;
    //       break;
    //     }
    //   }
    //   if (!collide) {
    //     create(event);
    //     selected = null;
    //
    //     document.getElementById("statusmsg").innerHTML =
    //       "Mouse down at " + event.clientX + ", " + event.clientY;
    //   }
    //   update();
    // }
  </script>

</head>

<body>
  <div id="title">
    <h1>Assignment 8</h1>
  </div>
  <canvas id="MyCanvas" ></canvas>
  <div id="buttonarea">
    &nbsp;
  </div>
  <p><b>Status: </b></b><span id="statusmsg">(Nothing Here)</span></p>
  <p><b>Animal Count: </b></b><span id="count">0</span></p>
  <p><b>Selected Animal: </b></b><span id="selected" style="font-size:60px;"></span></p>
</body>

</html>
